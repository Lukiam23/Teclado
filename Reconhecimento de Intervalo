#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <windows.h>
#include <math.h>
struct Nota /*O registro quardarÃ¡ informaÃ§Ãµes das notas como o nome, a frequencia e a oita a qual ela pertence*/
{
    char nome[7];
    int frequencia;
    int oitava;
};
struct intervalo
{
    char nome[10];
    float tom;
};
struct Nome
{
	char *nome;
};
void addinter(char *str,struct intervalo *vetor,float valor,int pos)
{
	strcpy(vetor[pos].nome,str);
	vetor[pos].tom=valor;
};
int search(struct intervalo *vetor, float value)
{
	int i = 0;
	while(vetor[i].tom!=value)
	{
		i++;
	}
	return i;
};
void printarvetor(struct intervalo *vetor)
{
	int count;
	for(count=0; count<7; count++)
	{
		printf("%s\n",vetor[count].nome);
	}
}
int notaPos(char* nome, struct Nota e[48]){ /*A funÃ§Ãµa recebe o nome,a oitava e um vetor de Notas e retorna a posiÃ§Ã£o da nota no vetor*/
		int i;
		for(i=0; i<12; i++)	{ /*A funÃ§Ã£o vai pecorrer a primeira oitava e verificar se os nomes sÃ£o iguais, se forem ele retorna a posiÃ§Ã£o da nota no vetor*/
			
			if(strcmp(e[i].nome, nome) == 0){
				return i;
			}			

		}
	
}
void addNotas(char *nome, int oitava, int frequencia, struct Nota *vetor, int pos)
{
	strcpy(vetor[pos].nome,nome);
	vetor[pos].oitava=oitava;
	vetor[pos].frequencia=frequencia;
}

void play(struct Nota *vetor, int n, int t)
{
	int i,c;
	for(i=0; i<n; i++)
	{
		for(c=0; c<12; c++)
		{
			int frequencia = vetor[c].frequencia*pow(2,i);
			printf("%s%d\n",vetor[c].nome,i+1);
			Beep(frequencia,t);
		}
	}
};
void playN(struct Nota *vetor, int oitavas,int t)
{
	int i,c, pos;
	struct Nome notas[7] = {"Do","Re","Mi","Fa","Sol","La","Si"};
	for(i=0; i<oitavas; i++)
	{
		for(c=0; c<7; c++)
		{
			pos = notaPos(notas[c].nome,vetor);
			printf("%s%d %d\n",vetor[pos].nome,i+1,vetor[pos].frequencia);
			Beep(vetor[pos].frequencia*pow(2,i),t);
		}
		
	}
}
int main()
{

    int i;
    struct Nota e[48];
    
    addNotas("Do",1,132,e,0);
    addNotas("Do#/Reb",1,137,e,1);
    addNotas("Re",1,148,e,2);
    addNotas("Re#/Mib",1,154,e,3);
    addNotas("Mi",1,165,e,4);
    addNotas("Fa",1,175,e,5);
    addNotas("Fa#/Solb",1,183,e,6);
    addNotas("Sol",1,198,e,7);
    addNotas("Sol#/Lab",1,206,e,8);
    addNotas("La",1,220,e,9);
    addNotas("La#/Sib",1,229,e,10);
    addNotas("Si",1,247,e,11);


	FILE *fp;
	
	fp = fopen("ode.txt","r");
	
	char nomeNota[7];
	int oitava;
	int tempoN;
	int posicao_aleatoria, intervalo;
	int t = 500;
	int escolha;
	float semitons;
	escolha=0;
	
	struct intervalo intervalos[10];
	addinter("2M",intervalos,1.0,1);
	addinter("2m",intervalos,0.5,0);
	addinter("3M",intervalos,2.0,3);
	addinter("3m",intervalos,1.5,2);
	addinter("4J",intervalos,2.5,4);
	addinter("5J",intervalos,3.5,6);
	addinter("4Aum",intervalos,3.0,5);
	
	while(1)
	{
		printf("\n\nFaca a sua escolha:\n1.Tocar Ode a alegria\n2.Advinhar intervalo\n3.Tocar escala cromatica\n4.Tocar a escala natural\n\n");
		printf("Digite a sua escolha: ");
		scanf("%d",&escolha);	
		
		if(escolha==1)
		{
			while( ( fscanf(fp, "%s %d %d\n", nomeNota, &oitava, &tempoN) ) != EOF )
			{/*Quando o programa ler o aruivo ele vai procurar pelo o nome da nota, a oitava e o tempo*/
				printf("%s %d %d\n", nomeNota, oitava, tempoN);
				int pos = notaPos(nomeNota, e);/*Aqui ele passa para pos a  posiÃ§Ã£o da nota, mas essa posiÃ§Ã£o Ã© apenas da primeira oitava*/
				Beep(e[pos].frequencia*pow(2,oitava),t*tempoN);/*ele passa para o Beep a frequencia e o tempo, ele pega a frequencia da nota na primera e transpÃµe pelo valor da oitava recebida*/	
			}
			escolha=0;
		}

		if(escolha==2)
		{
			char nome[10], input[10];
			posicao_aleatoria = rand()%7;/*Gerará um número aleatório*/
			semitons = posicao_aleatoria/2.0;
			i= search(intervalos, semitons);
			
			strcpy(nome,intervalos[i].nome);
			Beep(e[0].frequencia*pow(2,2),t*3);/*Tocará o Dó com frequencia igual a 264, pois o de 132 ´2 muito baixo*/
			Beep(e[posicao_aleatoria].frequencia*pow(2,2),t*3);/*Pegará a nota na primeira oitava e a transporá para a próxima oitava */
			printf("As opcoes sao:\n");
			printarvetor(intervalos);
			while(strcmp (input, nome) != 0)
			{
				printf("Digite o seu palpite: ");
				scanf("%s",&input);
				if(strcmp(input,"replay")==0)/*Fará com que as notas sejam tocadas novamente*/
				{
					Beep(e[0].frequencia*pow(2,2),t*3);
					Beep(e[posicao_aleatoria].frequencia*pow(2,2),t*3);
				}
			}
			Beep(e[9].frequencia*pow(2,2),t/2);
			Beep(e[10].frequencia*pow(2,2),t/2);
			printf("\nIsso foi uma %s\n", nome);
			printf("A primeira nota tocada foi um Do4 e a segunda nota tocada foi: %s %d\n",e[posicao_aleatoria].nome,e[posicao_aleatoria].oitava*2);
			escolha=0;
		}
		
		if(escolha==3)
		{
			play(e,4,t);
		}
		if(escolha==4)
		{
			playN(e,4,t);
		}
	}
	
}
